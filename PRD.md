# Face Mosaic Local - PRD (Product Requirements Document)

## 📋 개요

### 프로젝트명
**Face Mosaic Local** - 로컬 기반 얼굴 모자이크 처리 프로그램

### 목적
사진 폴더 내 이미지들의 인물 얼굴을 자동으로 감지하여 자연스럽게 모자이크 처리 후 저장하는 프로그램

### 핵심 가치
- **완전 무료**: API 비용 없이 로컬에서 처리
- **프라이버시**: 이미지가 외부 서버로 전송되지 않음
- **오프라인**: 인터넷 연결 없이 동작

---

## 🎯 기능 요구사항

### 필수 기능 (MVP)

#### FR-001: 폴더 선택
- 입력 폴더 경로 지정
- 출력 폴더 경로 지정 (기본값: `./output`)
- 지원 포맷: JPG, JPEG, PNG, BMP, WEBP

#### FR-002: 얼굴 감지
- OpenCV DNN 또는 Haar Cascade 기반 감지
- 다중 얼굴 동시 감지 지원
- 다양한 각도의 얼굴 감지 (정면, 측면)

#### FR-003: 모자이크 처리
- 감지된 얼굴 영역에 모자이크 적용
- 모자이크 강도 조절 가능 (픽셀 크기)
- 자연스러운 블러 옵션 제공

#### FR-004: 일괄 처리
- 폴더 내 모든 이미지 순차 처리
- 진행 상황 표시 (progress bar)
- 처리 결과 로그 출력

#### FR-005: 결과 저장
- 원본 파일명 유지 또는 접미사 추가 옵션
- 원본 이미지 메타데이터 보존
- 출력 품질 설정 가능

### 선택 기능 (Nice-to-have)

#### FR-006: GUI 인터페이스
- 폴더 선택 다이얼로그
- 미리보기 기능
- 실시간 처리 현황

#### FR-007: 고급 옵션
- 특정 얼굴만 제외 (수동 선택)
- 얼굴 감지 민감도 조절
- 배치 크기 설정

#### FR-008: 로고 추가 기능
- 처리된 이미지에 로고 이미지 추가
- 우측 하단 위치에 배치
- 로고 크기 조절 가능 (비율 또는 절대 크기)
- 로고 투명도 조절 가능 (PNG 알파 채널 지원)
- 로고 여백(margin) 설정 가능
- 로고 파일 경로 지정 (PNG, JPG, JPEG 지원)

#### FR-012: 수동 모자이크 지정 기능
- input 폴더에서 이미지를 하나씩 선택
- 마우스 드래그로 영역 직접 지정
- 여러 영역 지정 가능 (다중 선택)
- 선택된 영역에 모자이크 적용
- 모자이크 픽셀 사이즈 실시간 조절 가능
- 선택된 영역 시각적 표시 (사각형)
- 영역 삭제 기능 (선택된 영역 제거)
- 처리된 이미지를 output 폴더로 저장
- 이미지 간 이동 (이전/다음 이미지)

---

## 🛠 기술 스택

### 필수 라이브러리
| 라이브러리 | 버전 | 용도 |
|-----------|------|------|
| Python | 3.9+ | 런타임 |
| OpenCV (cv2) | 4.8+ | 얼굴 감지 & 이미지 처리 |
| NumPy | 1.24+ | 배열 연산 |
| Pillow | 10.0+ | 이미지 I/O, 메타데이터 |
| tqdm | 4.65+ | 진행률 표시 |

### 선택 라이브러리 (GUI)
| 라이브러리 | 버전 | 용도 |
|-----------|------|------|
| tkinter | 내장 | GUI (기본) |
| PyQt6 | 6.5+ | GUI (고급) |

---

## 📁 프로젝트 구조

```
face-mosaic-local/
├── PRD.md                    # 이 문서
├── Tasks.md                  # 작업 체크리스트
├── README.md                 # 사용 가이드
├── requirements.txt          # 의존성
├── setup.py                  # 패키지 설정
├── .gitignore
│
├── src/
│   ├── __init__.py
│   ├── main.py               # CLI 진입점
│   ├── detector.py           # 얼굴 감지 모듈
│   ├── mosaic.py             # 모자이크 처리 모듈
│   ├── processor.py          # 일괄 처리 로직
│   ├── utils.py              # 유틸리티 함수
│   └── watermark.py          # 로고/워터마크 추가 모듈
│
├── models/                   # 사전학습 모델 (DNN)
│   ├── deploy.prototxt
│   └── res10_300x300_ssd_iter_140000.caffemodel
│
├── logo/                     # 로고 파일 저장 (선택)
│   └── logo.png              # 기본 로고 파일
│
├── tests/
│   ├── __init__.py
│   ├── test_detector.py
│   ├── test_mosaic.py
│   └── test_watermark.py
│
├── input/                    # 샘플 입력 (gitignore)
└── output/                   # 처리 결과 (gitignore)
```

---

## 🔧 얼굴 감지 방식 비교

### 옵션 1: Haar Cascade (기본)
- **장점**: 가볍고 빠름, 추가 모델 다운로드 불필요
- **단점**: 정확도 낮음, 측면/기울어진 얼굴 감지 어려움
- **파일**: OpenCV 내장 (`haarcascade_frontalface_default.xml`)

### 옵션 2: DNN (SSD + ResNet) ⭐ 권장
- **장점**: 높은 정확도, 다양한 각도 지원
- **단점**: 모델 파일 다운로드 필요 (~10MB)
- **파일**: `res10_300x300_ssd_iter_140000.caffemodel`

### 옵션 3: MediaPipe Face Detection
- **장점**: 매우 높은 정확도, 실시간 처리
- **단점**: 추가 의존성
- **파일**: 자동 다운로드

---

## 📊 성능 요구사항

| 항목 | 목표값 |
|------|--------|
| 처리 속도 | 1초/장 (1080p 기준) |
| 메모리 사용 | < 500MB |
| 감지 정확도 | > 90% (정면 얼굴) |
| 지원 이미지 크기 | 최대 8K (7680x4320) |

---

## 🚀 사용 시나리오

### CLI 사용 예시
```bash
# 기본 사용
python -m src.main --input ./photos --output ./output

# 옵션 지정
python -m src.main \
  --input ./photos \
  --output ./output \
  --mosaic-size 15 \
  --detector dnn \
  --confidence 0.5

# 로고 추가 옵션
python -m src.main \
  --input ./photos \
  --output ./output \
  --logo ./logo/logo.png \
  --logo-size 0.1 \
  --logo-margin 20
```

### Python 모듈 사용
```python
from src.processor import FaceMosaicProcessor

processor = FaceMosaicProcessor(
    detector='dnn',
    mosaic_size=15
)
processor.process_folder('./photos', './output')
```

---

## ✅ 완료 기준

### MVP 완료 조건
- [ ] 단일 이미지에서 얼굴 감지 및 모자이크 적용
- [ ] 폴더 내 이미지 일괄 처리
- [ ] CLI 인터페이스로 실행 가능
- [ ] 처리 결과 로그 출력
- [ ] README 문서 작성

### v1.0 완료 조건
- [ ] MVP 완료
- [ ] 두 가지 감지 방식 지원 (Haar, DNN)
- [ ] 모자이크/블러 옵션 선택
- [ ] 단위 테스트 작성
- [ ] 에러 핸들링 완비

### v1.1 완료 조건 (로고 추가 기능)
- [ ] 로고 추가 모듈 구현
- [ ] 우측 하단 위치 배치
- [ ] 로고 크기/투명도/여백 조절
- [ ] CLI 옵션 추가
- [ ] 단위 테스트 작성

### v1.2 완료 조건 (단일 실행 프로그램)
- [ ] PyInstaller 설정 파일 작성
- [ ] 모든 의존성 포함 확인
- [ ] DNN 모델 파일 포함 확인
- [ ] 플랫폼별 빌드 스크립트 작성
- [ ] 실행 파일 테스트
- [ ] 배포 패키지 생성

### v1.3 완료 조건 (GUI 인터페이스)
- [ ] GUI 메인 윈도우 구현
- [ ] 폴더 선택 다이얼로그
- [ ] 옵션 설정 UI 구성
- [ ] 진행 상황 표시
- [ ] 로그 출력 영역
- [ ] 에러 핸들링 및 메시지 표시
- [ ] GUI 테스트

### v1.4 완료 조건 (macOS 앱 빌드)
- [ ] macOS .app 번들 생성
- [ ] 앱 아이콘 설정 (.icns 파일)
- [ ] Info.plist 설정 (앱 정보, 권한)
- [ ] GUI 모드로 실행되도록 설정 (--windowed)
- [ ] DMG 패키징 (선택)
- [ ] 코드 서명 (선택, 배포용)
- [ ] macOS 앱 테스트

### v1.5 완료 조건 (수동 모자이크 지정 기능)
- [ ] 이미지 선택 인터페이스 (input 폴더에서 이미지 목록)
- [ ] 마우스 드래그로 영역 선택 기능
- [ ] 선택된 영역 시각적 표시 (사각형)
- [ ] 여러 영역 선택 및 관리
- [ ] 모자이크 크기 실시간 조절
- [ ] 영역 삭제 기능
- [ ] 이미지 간 이동 (이전/다음)
- [ ] 처리된 이미지 저장 (output 폴더)
- [ ] 사용자 인터페이스 테스트


---

## 📅 일정

| 단계 | 예상 소요 | 산출물 |
|------|----------|--------|
| 환경 설정 | 30분 | requirements.txt, 프로젝트 구조 |
| 얼굴 감지 모듈 | 1시간 | detector.py |
| 모자이크 모듈 | 30분 | mosaic.py |
| 일괄 처리 | 1시간 | processor.py, main.py |
| 테스트 & 문서 | 1시간 | tests/, README.md |
| 로고 추가 기능 | 1시간 | watermark.py, 테스트 |
| 단일 실행 프로그램 | 2시간 | PyInstaller 설정, 빌드 스크립트 |
| GUI 인터페이스 | 3시간 | gui/main_window.py, UI 구성 |
| macOS 앱 빌드 | 1.5시간 | .app 번들, 아이콘, Info.plist, DMG |
| 수동 모자이크 지정 | 2.5시간 | gui/manual_mosaic_window.py, 마우스 이벤트 처리 |
| **총계** | **15시간** | |

---

## 📝 변경 이력

| 버전 | 날짜 | 내용 |
|------|------|------|
| 0.1 | 2026-01-12 | 초안 작성 |
| 0.2 | 2026-01-12 | 로고 추가 기능 요구사항 추가 (FR-008) |
| 0.3 | 2026-01-12 | 단일 실행 프로그램 및 GUI 인터페이스 요구사항 추가 (FR-009, FR-010) |
| 0.4 | 2026-01-12 | macOS 앱 빌드 요구사항 추가 |
| 0.5 | 2026-01-12 | 수동 모자이크 지정 기능 요구사항 추가 (FR-012) |